@model SimpleCrm.VM.PaginatedViewModel<SimpleCrm.VM.FollowedClientsDto>
@{
    ViewData["Title"] = "Followed Clients";
    var users = ViewBag.users;
}

<div>
    <h1 class="text-center mb-5">Followed Clients</h1>
    <div class="row mb-2">
        <div class="col-md-6 col-sm-12">
            
        </div>
        <div class="col-md-2 col-sm-0"></div>
        <div class="col-md-4 col-sm-12">
            <form method="get" class="d-flex">
                <input class="form-control me-2 " type="search" placeholder="Search" name="searchQuery" aria-label="Search" id="searchInput">
                <button class="btn btn-outline-success" type="submit">Search</button>
            </form>
        </div>
    </div>

    <table class="table table-bordered table-hover table-responsive">
        <thead class="text-center bg-black text-white">
            <tr>
                <th scope="col">Name</th>
                <th scope="col">Phone</th>
                <th scope="col">From</th>
                <th scope="col">To</th>                
                <th scope="col">Action</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var client in Model.Items)
            {
                <tr class="client-row">
                    <td>@client.Name</td>
                    <td><a href="https://wa.me/@client.Phone">@client.Phone</a> </td>
                    <td>@client.From</td>
                    <td>@client.To</td>
                    <td class="text-center buttons">
                        <button class="btn btn-danger" id="delete-@client.Id" onclick="deleteClient('@client.Id')"><i class="bi bi-trash"></i> Delete</button>
                    </td>
                </tr>
            }


        </tbody>
    </table>
    <div class="pagination-controls">
        <!-- Previous Button -->
        @if (Model.HasPreviousPage)
        {
            <a asp-action="Index" asp-route-pageNumber="@(Model.PageNumber - 1)" class="btn btn-success">Previous</a>
        }
        else
        {
            <span class="disabled btn btn-success">Previous</span>
        }

        <!-- Arrow to Previous Set of Pages -->
        @if (Model.StartPage > 1)
        {
            <a asp-action="Index" asp-route-pageNumber="@(Model.StartPage - 1)" class="btn btn-success">&laquo;</a>
        }

        <!-- Page Numbers (1-10, 11-20, etc.) -->
        @for (int i = Model.StartPage; i <= Model.EndPage; i++)
        {
            <a asp-action="Index" asp-route-pageNumber="@i" class="@(Model.PageNumber == i ? "active btn btn-success" : "btn btn-success")">@i</a>
        }

        <!-- Arrow to Next Set of Pages -->
        @if (Model.EndPage < Model.TotalPages)
        {
            <a asp-action="Index" asp-route-pageNumber="@(Model.EndPage + 1)" class="btn btn-success">&raquo;</a>
        }

        <!-- Next Button -->
        @if (Model.HasNextPage)
        {
            <a asp-action="Index" asp-route-pageNumber="@(Model.PageNumber + 1)" class="btn btn-success">Next</a>
        }
        else
        {
            <span class="disabled btn btn-success">Next</span>
        }
    </div>

</div>




<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    function deleteClient(clientId) {
        $.ajax({
            url: '/FollowedClients/Delete/' + clientId,
            type: 'PUT',
            success: function (result) {
                refreshClientTable();
                toastr.success('Client deleted successfully!', 'Success', { timeOut: 5000 })
            },
            error: function (xhr, status, error) {
                toastr.error('Failed to delete client!', 'error', { timeOut: 5000 })
            }
        });
    }
    function refreshClientTable() {
        $.ajax({
            url: '@Url.Action("Index", "FollowedClients")',
            type: 'GET',
            success: function (result) {
                $('table tbody').html($(result).find('table tbody').html());
            },
            error: function (xhr, status, error) {
                console.error("Failed to refresh the client table: ", error);
                alert("An error occurred while refreshing the table.");
            }
        });
    }
  
</script>



